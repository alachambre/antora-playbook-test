<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>How to integrate BCD with Jenkins | Bonita documentation 2.0</title>
<link rel="canonical" href="http://localhost:8080/documentation/bcd/3.4/jenkins_example.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="bcd">
<meta name="dcterms.identifier" content="3.4">
<meta name="generator" content="Antora 2.3.4">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">

              <a class="navbar-brand" href="http://localhost:8080/documentation/bonita/7.12.0/index.html">
                <img src="../../_/img/couchbase-documentation-logo.svg" alt="Couchbase" />
              </a>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <div class="parent-site">
                  <a href="https://www.couchbase.com">
                    Couchbase.com
                  </a>
                </div>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Try Free
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Bonita Continous Delivery</span></h4>
<a class="frame-link component" href="index.html"> <span class="version">3.4</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item " data-depth="0">

<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="release_notes.html">Release notes</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="requirements-and-compatibility.html">Requirements and compatibility</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="getting_started.html">Getting started</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="upgrade_bcd.html">Upgrade BCD</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="#_bcd_services_and_scenarios.adoc">BCD services and scenarios</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="bcd_controller.html">Controller Docker image</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="bcd_cli.html">Command-line interface</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="scenarios.html">Scenario file reference</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="#_howtos.adoc">Howtos</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="#_manage_stack.adoc">Manage Bonita stacks</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="aws_prerequisites.html">Configure Amazon Web Services (AWS) for BCD</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="aws_sso.html">Configure AWS single sign-on</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="aws_organizations.html">Assume IAM role within AWS Organizations</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="azure-prerequisites.html">Configure Microsoft Azure for BCD</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="deploy_with_static_inventory.html">Deploy with a static inventory</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="deploy-with-existing-database.html">Deploy with an existing database</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="#_custom_init.adoc">Customize the Bonita container</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="custom_init.html">Using initialization scripts</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="how_to_configure_rest_api_authorization.html">Configuring REST API authorization</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="how_to_enable_remote_monitoring_jmx.html">Enabling remote monitoring with JMX</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="manage_bonita_licenses.html">Manage Bonita licenses</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="#_manage_living_application.adoc">Manage Bonita Living Applications</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="livingapp_build.html">Build a Living App repository</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="livingapp_manage_configuration.html">Manage Living App configuration</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="livingapp_deploy.html">Deploy Living App artifacts</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="livingapp_build_and_deploy.html">Build and deploy (Best Practices)</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="how_to_use_bcd_with_data_encrypted.html">Use BCD with sensitive data encrypted</a>
</span>
</li>
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="jenkins_example.html">Integrate BCD with Jenkins</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="troubleshooting_guide.html">Troubleshooting guide</a>
</span>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/alachambre/antora-sources-test-2/edit/master/modules/ROOT/pages/jenkins_example.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="index.html">Bonita Continous Delivery</a></li>
<li class="crumb"><a href="#_howtos.adoc">Howtos</a></li>
<li class="crumb"><a href="jenkins_example.html">Integrate BCD with Jenkins</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">How to integrate BCD with Jenkins</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The BCD controller can not only be run interactively, but also within standard Continuous Delivery servers such as <a href="https://jenkins.io/">Jenkins automation server</a>.</p>
</div>
<div class="paragraph">
<p>This page describes 2 approaches to using BCD with Jenkins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, a tutorial shows how to set up an <strong>existing Jenkins</strong> platform to start using BCD.</p>
</li>
<li>
<p>Second, a <strong>standalone example</strong> lets you start a pre-configured Jenkins server with a BCD-aware Jenkins slave and ready-to-use Jenkins jobs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_tutorial"><a class="anchor" href="#_integration_tutorial"></a>Integration tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are different ways to run BCD jobs with an existing Jenkins server.
+ Here is one recommended setup that requires a Docker host and little changes to your existing Jenkins instance.
+ With this setup, the Jenkins master, thanks to the <a href="https://plugins.jenkins.io/docker-plugin">Jenkins Docker plugin</a>, uses the <strong>Docker host</strong> to dynamically provision build agents.
On the other hand, the Docker host needs to have the BCD controller image loaded and the <code>BCD_HOME</code> directory mounted.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/bcd_jenkins.png" alt="Bonita Continuous Delivery with Jenkins">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p>warning This tutorial assumes you are already running a <a href="https://jenkins.io/2.0/">Jenkins 2</a> instance and that you are familiar with Jenkins system administration.</p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>=== Install Docker host</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These steps are to be completed on the Docker host.</p>
</div>
<div class="sect3">
<h4 id="_1_install_docker_and_enable_remote_access"><a class="anchor" href="#_1_install_docker_and_enable_remote_access"></a>1. Install Docker and enable remote access</h4>
<div class="paragraph">
<p>The Docker host needs to run the Docker engine (Community or Enterprise Edition) and can be installed on any <a href="https://docs.docker.com/install/#supported-platforms">supported platforms</a>.
+ Besides, the Docker daemon must be accessible remotely on a TCP socket.
The <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-socket-option">Docker documentation</a> describes how to enable the TCP socket.
+ It is also highly recommended to <a href="https://docs.docker.com/engine/security/https/">protect the Docker daemon socket</a> by enabling the TLS protocol.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_install_bcd"><a class="anchor" href="#_2_install_bcd"></a>2. Install BCD</h4>
<div class="paragraph">
<p>BCD must be installed on the Docker host which acts here as a <strong>control host</strong>.
The installation procedure is described in the <a href="getting_started.html" class="page">Getting started</a> guide.
+ The Docker host should now have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>bonitasoft/bcd-controller</code> Docker image loaded</p>
</li>
<li>
<p>the <code>bonita-continuous-delivery_&lt;version&gt;</code> directory present</p>
</li>
<li>
<p>optionally, the security files for BCD provisioning (SSH key files, AWS credentials)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configure_jenkins_master"><a class="anchor" href="#_configure_jenkins_master"></a>Configure Jenkins master</h3>
<div class="paragraph">
<p>These steps are to be completed on the Jenkins master.</p>
</div>
<div class="sect3">
<h4 id="_1_install_docker_client"><a class="anchor" href="#_1_install_docker_client"></a>1. Install Docker client</h4>
<div class="paragraph">
<p>Follow the <a href="https://docs.docker.com/install/">Docker documentation</a> to have Docker installed on Jenkins master.
Actually only the Docker CLI is required.
For example <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-docker-ce-1">on Ubuntu</a> you only need to install the <code>docker-ce-cli</code> package.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_install_required_plugins"><a class="anchor" href="#_2_install_required_plugins"></a>2. Install required plugins</h4>
<div class="paragraph">
<p>The Jenkins master must have the <a href="https://plugins.jenkins.io/docker-plugin">Docker plugin</a> installed.
The Docker plugin is a "Cloud" implementation that lets you add a new Cloud of type "Docker" on Jenkins master.
+ Additionally, it is recommended to use <a href="https://jenkins.io/pipeline/getting-started-pipelines/">Pipelines</a> while using BCD with Jenkins.
You can still use standard Jenkins "freestyle" jobs but pipelines are more designed for continuous delivery.
Therefore this requires to install the <a href="https://plugins.jenkins.io/workflow-aggregator">Pipeline plugin</a> (aka.
<code>workflow-aggregator</code>).
+ This tutorial also provides an example pipeline which requires the <a href="https://plugins.jenkins.io/pipeline-utility-steps">Pipeline Utility Steps</a>, <a href="https://plugins.jenkins.io/pipeline-github-lib">Pipeline: GitHub Groovy Libraries</a> and <a href="https://plugins.jenkins.io/ansicolor">AnsiColor</a> plugins to be installed.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p>info The <a href="https://jenkins.io/doc/book/managing/plugins/#installing-a-plugin">Jenkins plugins documentation</a> describes different methods for installing plugins on master.</p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>==== 3. Add Docker Host credentials</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As recommended previously, the Docker host should have TLS enabled.
Therefore, the Docker host credentials must be added to Jenkins master.
+ Follow the <a href="https://jenkins.io/doc/book/using/using-credentials/#adding-new-global-credentials">Jenkins credentials documentation</a> to add new <strong>Docker Host Certificate Authentication</strong> credentials.
These credentials are required to declare a secured Docker cloud in the next step.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p>danger If your Docker TCP socket is not secured, then you can skip this step.
But bear in mind that exposing the Docker TCP socket without TLS is really <strong>not safe</strong>.</p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>image::images/jenkins_add_docker_client_cert_auth.png[Add Docker Host Certificate Authentication]</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition, you will have to add a new <strong>Username with password</strong> credentials to grant access to <strong>quay.io</strong> Docker registry.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/jenkins_add_quay_auth.png" alt="Add Username with password">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_4_add_a_new_cloud"><a class="anchor" href="#_4_add_a_new_cloud"></a>4. Add a new Cloud</h4>
<div class="paragraph">
<p>This step instructs Jenkins master to add a new <em>Cloud</em> of type Docker in order to provision build agents for BCD jobs.</p>
</div>
<div class="paragraph">
<p>Follow these steps to add a Docker cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit Jenkins system configuration (<span class="menuseq"><b class="menu">Jenkins</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Manage Jenkins</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure System</b></span>) and <strong>Add a new cloud</strong> of type <em>Docker</em>.</p>
</li>
<li>
<p>Give it a <strong>Name</strong> and a <strong>Docker Host URI</strong> like <code>tcp://dockerhost:2376</code> (where <code>dockerhost</code> is the hostname or IP of the Docker host).
+ <em>It is conventional to use port <code>2376</code> when TLS is enabled, and port <code>2375</code> for un-encrypted communication with the Docker daemon.</em></p>
</li>
<li>
<p>With a secured Docker TCP socket, select the <strong>Server credentials</strong> created previously.
Otherwise, select <em>None</em>.</p>
</li>
<li>
<p>Click on <strong>Test Connection</strong> to confirm your configuration is correct.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/jenkins-add_cloud.png" alt="Jenkins add Docker cloud">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_add_docker_template"><a class="anchor" href="#_5_add_docker_template"></a>5. Add Docker template</h4>
<div class="paragraph">
<p>A Docker template must be added to define how to start Jenkins build agents as BCD controller containers.</p>
</div>
<div class="paragraph">
<p>Click on <strong>Add Docker template</strong> to add a Docker template in the Docker cloud and filling in the fields as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Labels</strong>: <code>bcd</code></p>
</li>
<li>
<p><strong>Enabled</strong>: <code>[checked]</code></p>
</li>
<li>
<p><strong>Name</strong>: <code>bcd</code></p>
</li>
<li>
<p><strong>Docker Image</strong>: <code>quay.io/bonitasoft/bcd-controller:3.0.1</code> (where 3.0.1 is the version of BCD to use)</p>
</li>
<li>
<p><strong>Volumes</strong>:</p>
<div class="listingblock">
<div class="content">
<pre>/home/dockeruser/bonita-continuous-delivery_3.0.1:/home/bonita/bonita-continuous-delivery
/home/dockeruser/.ssh:/home/bonita/.ssh
bcd-dependencies-7.8.0:/home/bonita/bonita-continuous-delivery/dependencies/7.8.0</pre>
</div>
</div>
</li>
<li>
<p><strong>Environment</strong>: <code>ANSIBLE_FORCE_COLOR=true</code> (this forces colored output in BCD logs)</p>
</li>
<li>
<p><strong>Remote File System Root</strong>: <code>/home/bonita</code></p>
</li>
<li>
<p><strong>Connect method</strong>: <code>Attach Docker container</code> - <strong>User</strong>: <code>bonita</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images/jenkins-add_docker_template.png" alt="Jenkins add Docker template">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p>info Jenkins is now ready to run BCD Pipelines.
An example scripted pipeline is provided in the next section.</p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>=== Create a Pipeline job</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Create a <strong>Pipeline</strong> item with a <code>BCD_SCENARIO</code> String parameter which sets the BCD scenario path as an environment variable.
+ For instance, the <code>BCD_SCENARIO</code> parameter can be set to <code>scenarios/build_and_deploy.yml</code>.
+ Then here is an example pipeline script that builds a LivingApp repository and deploys its artifacts on an already running Bonita platform:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Library('github.com/bonitasoft/bonita-jenkins-library@1.0.0') _

node('master') {
    stage('Retrieve dependencies') {
        docker.withServer('tcp://dockerhost:2376', 'DOCKER_CLIENT_CERT_AUTH') {
            docker.withRegistry('https://quay.io', 'QUAY_AUTH') {
                docker.image('quay.io/bonitasoft/bcd-dependencies:7.8.0').withRun('-v bcd-dependencies-7.8.0:/dependencies') {
                }
            }
        }
    }
}

node('bcd') {
    ansiColor('xterm') {

        stage('Git Ckeckout') {
            git url: 'https://github.com/bonitasoft/bonita-vacation-management-example',
            branch: 'dev/7.8.0'
        }

        stage('build-bonita-app') {
            bcd args: "livingapp build -p ${WORKSPACE} -e Test"
        }

        def jobBaseName = "${env.JOB_NAME}".split('/').last()

        stage('deploy-bonita-app') {
            def zip_files = findFiles(glob: "target/${jobBaseName}-*.zip")
            def bconf_files = findFiles(glob: "target/${jobBaseName}-*.bconf")
            if (bconf_files != null &amp;&amp; bconf_files.length &gt; 0)
                bcd args: "livingapp deploy -p ${WORKSPACE}/${zip_files[0].path} -c ${WORKSPACE}/${bconf_files[0].path}"
            else
                bcd args: "livingapp deploy -p ${WORKSPACE}/${zip_files[0].path}"
        }

        stage('archive-artifacts') {
            archiveArtifacts artifacts: "target/${jobBaseName}/**/*.*, target/${jobBaseName}-*.*, .bcd_configurations/*.yml", fingerprint: true
        }

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pipeline uses a Jenkins shared library <a href="https://github.com/bonitasoft/bonita-jenkins-library">hosted on GitHub</a>.
+ This scripted pipeline can also be used in a <a href="https://jenkins.io/doc/book/pipeline/jenkinsfile/">Jenkinsfile</a> and it can be checked into your LivingApp repository.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_standalone_example"><a class="anchor" href="#_standalone_example"></a>Standalone example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>bonita-continuous-delivery_&lt;version&gt;.zip</code> archive also provides a <code>jenkins-example</code> directory which contains a minimal working example of a Continuous Delivery platform with Jenkins and BCD.
This example will start a pre-configured Jenkins server with a BCD-aware Jenkins slave and ready-to-use Jenkins jobs.</p>
</div>
<div class="paragraph">
<p>It is provided as a <a href="https://docs.docker.com/compose/">Docker Compose</a> project.</p>
</div>
<div class="paragraph">
<p>Therefore you should have <strong>Docker and Docker Compose</strong> installed on the target host to run this example.</p>
</div>
<div class="paragraph">
<p>This example is provided with Compose file version 3.2 which requires Docker Compose 1.12.0+ and Docker Engine 17.04.0+.
Refer to <a href="https://docs.docker.com/compose/compose-file/#compose-and-docker-compatibility-matrix">Compose and Docker compatibility matrix</a> and <a href="https://docs.docker.com/release-notes/docker-compose/">Compose release notes</a> for further details.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p>info In this example, a Jenkins slave is created from a Docker image which extends the BCD Controller image.
Then an example job is defined as a <a href="https://jenkins.io/doc/book/pipeline/">Jenkins Pipeline</a> job in which <code>bcd</code> commands are invoked.
+ This allows you to easily re-use parts of this example in your own Jenkins instance.</p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>=== Step-by-step run guide</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here is a step-by-step guide to run this example.
+ The following commands are to be executed on the target host where Jenkins is to be installed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the Docker Compose project.</p>
<div class="ulist">
<ul>
<li>
<p>Rename the <code>docker-compose.override.yml.EXAMPLE</code> file to <code>docker-compose.override.yml</code> (remove the <code>.EXAMPLE</code> extension).</p>
</li>
<li>
<p>Configure <code>environment</code> and <code>volumes</code> sections and save.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure initial secrets used by Jenkins and BCD.</p>
<div class="ulist">
<ul>
<li>
<p>Rename the <code>secrets/*Password.EXAMPLE</code> files to <code>secrets/*Password</code> (remove the <code>.EXAMPLE</code> extension).
+ With most Linux distributions, you can do this with the <code>rename</code> command line tool as follows: <code>rename 's/.EXAMPLE//' *.EXAMPLE</code>).</p>
</li>
<li>
<p>Configure each <code>*Password</code> file with appropriate credentials.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Make sure the BCD Controller Docker image is loaded as described in the installation section of the <a href="bcd_controller.html" class="page">BCD controller Docker image</a> page.</p>
</li>
<li>
<p>Create and start containers with Docker Compose.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd jenkins_example
$ docker-compose up -d</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p>warning <strong>Important Note</strong>: Ensure volumes configured are correctly mapped to existing files or folder on the host, otherwise the docker daemon will create empty folders at the configured location (default docker behavior for volumes).
As an example, if you declare a volume mapping in your <code>docker-compose.override.yml</code> file for the file <code>secrets/bonitaPassword</code> and you forget to create the corresponding file in the <code>secrets</code> folder, you will end up with a folder named <code>bonitaPassword</code> after the first docker-compose run.</p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>As a result Jenkins is up and running on port <code>9090</code> of the target host.
+ You can now log-in to Jenkins using one of the pre-configured users:</p>
<div class="ulist">
<ul>
<li>
<p><code>admin</code> - User with administration rights.
Password has been initialized with <code>secrets/adminPassword</code>.</p>
</li>
<li>
<p><code>bonita</code> - User with limited rights.
Password has been initialized with <code>secrets/bonitaPassword</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>warning <strong>Important Note</strong>: Prepare your BCD scenario and dependencies as usual before using the pre-configured Jenkins jobs.</p>
</dd>
<dt class="hdlist1"></dt>
<dd>
<p>=== Pre-configured Jenkins jobs</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once authenticated to Jenkins you can now launch pre-configured jobs.
+ This example project provides the following jobs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bcd-pipeline</code> - this job shows how the BCD CLI can be used to build a Continuous Delivery pipeline for a Bonita Living Application.</p>
</li>
<li>
<p><code>bcd-undeploy</code> - this job allows to undeploy a Bonita stack (by removing Docker containers) and if needed it can also destroy AWS EC2 machines when using BCD with AWS cloud provider.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>Â© 2020 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../_/js/vendor/fontawesome.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
